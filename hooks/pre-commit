#!/bin/bash

# Pre-commit hook to run linters on staged files
# This hook runs automatically before each commit to ensure code quality

echo "Running pre-commit linting checks..."

# Get list of staged files
STAGED_CSS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(css|scss)$' || true)
STAGED_JS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.js$' || true)
STAGED_MD=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.md$' || true)

# Track if any linter fails
LINT_FAILED=0

# Run CSS linting if CSS/SCSS files are staged
if [ -n "$STAGED_CSS" ]; then
  echo "â†’ Linting CSS/SCSS files..."
  if ! npm run lint:css --silent 2>/dev/null; then
    echo "âŒ CSS linting failed!"
    echo "ğŸ’¡ Fix issues with: npm run fix:css"
    LINT_FAILED=1
  else
    echo "âœ“ CSS linting passed"
  fi
fi

# Run JavaScript linting if JS files are staged
if [ -n "$STAGED_JS" ]; then
  echo "â†’ Linting JavaScript files..."
  if ! npm run lint:js --silent 2>/dev/null; then
    echo "âŒ JavaScript linting failed!"
    echo "ğŸ’¡ Fix issues with: npm run fix:js"
    LINT_FAILED=1
  else
    echo "âœ“ JavaScript linting passed"
  fi
fi

# Run Markdown linting if MD files are staged
if [ -n "$STAGED_MD" ]; then
  echo "â†’ Linting Markdown files..."
  if ! npm run lint:md --silent 2>/dev/null; then
    echo "âŒ Markdown linting failed!"
    echo "ğŸ’¡ Fix issues with: npm run fix:md"
    LINT_FAILED=1
  else
    echo "âœ“ Markdown linting passed"
  fi
fi

# Exit with error if any linter failed
if [ $LINT_FAILED -eq 1 ]; then
  echo ""
  echo "ğŸš« Commit rejected due to linting errors"
  echo "Fix the errors above or use 'git commit --no-verify' to bypass (not recommended)"
  exit 1
fi

echo "âœ… All linting checks passed!"
exit 0
