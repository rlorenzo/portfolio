#!/bin/bash

# Pre-commit hook to run linters on staged files
# This hook runs automatically before each commit to ensure code quality

echo "Running pre-commit linting checks..."

# Get list of staged files
STAGED_CSS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(css|scss)$' || true)
STAGED_JS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.js$' || true)
STAGED_MD=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.md$' || true)

# Track if any linter fails
LINT_FAILED=0

# Run CSS linting if CSS/SCSS files are staged
if [ -n "$STAGED_CSS" ]; then
  echo "‚Üí Linting CSS/SCSS files..."
  if ! echo "$STAGED_CSS" | xargs npx stylelint --quiet; then
    echo "‚ùå CSS linting failed!"
    echo "üí° Fix issues with: npx stylelint --fix $STAGED_CSS"
    LINT_FAILED=1
  else
    echo "‚úì CSS linting passed"
  fi
fi

# Run JavaScript linting if JS files are staged
if [ -n "$STAGED_JS" ]; then
  echo "‚Üí Linting JavaScript files..."
  if ! echo "$STAGED_JS" | xargs npx eslint; then
    echo "‚ùå JavaScript linting failed!"
    echo "üí° Fix issues with: npx eslint --fix $STAGED_JS"
    LINT_FAILED=1
  else
    echo "‚úì JavaScript linting passed"
  fi
fi

# Run Markdown linting if MD files are staged
if [ -n "$STAGED_MD" ]; then
  echo "‚Üí Linting Markdown files..."
  if ! echo "$STAGED_MD" | xargs npx markdownlint; then
    echo "‚ùå Markdown linting failed!"
    echo "üí° Fix issues with: npx markdownlint --fix $STAGED_MD"
    LINT_FAILED=1
  else
    echo "‚úì Markdown linting passed"
  fi
fi

# Exit with error if any linter failed
if [ $LINT_FAILED -eq 1 ]; then
  echo ""
  echo "üö´ Commit rejected due to linting errors"
  echo "Fix the errors above or use 'git commit --no-verify' to bypass (not recommended)"
  exit 1
fi

echo "‚úÖ All linting checks passed!"
exit 0
